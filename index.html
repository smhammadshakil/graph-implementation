<!DOCTYPE html>
<html lang="en">
  <head>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
    <style type="text/css">
      #container {
        width: 60%;
        margin: 0 auto;
        border: 2px solid black;
        margin-top: 50px;
        margin-bottom: 50px;
      }
      .wrap {
        padding: 2rem;
      }
    </style>
  </head>
  <script>
    // Test graph: AB5, BC4, CD8, DC8, DE6, AD5, CE2, EB3, AE7
    const testGraph = ['AB5', 'BC4', 'CD8', 'DC8', 'DE6', 'AD5', 'CE2', 'EB3', 'AE7']

    class Graph {
      constructor() {
        this.AdjList = new Map()
        this.AdjListDistance = new Map()
        this.allPaths = {}
        this.allPathsDis = {}
      }
      
      // BASIC METHODS
      addVertex(vertex) {
        if (!this.AdjList.has(vertex)) {
          this.AdjList.set(vertex, [])
          this.AdjListDistance.set(vertex, [])
        } else {
          throw 'Already Exist!!'
        }
      }
      
      addEdge(vertex, node, dis) {
        if (this.AdjList.has(vertex)) {
          if (this.AdjList.has(node)){
            let arr = this.AdjList.get(vertex)
            let arrDis = this.AdjListDistance.get(vertex)
            if(!arr.includes(node)){
              arr.push(node)
              arrDis.push(dis)
            }
          }else {
            throw `Can't add non-existing vertex ->'${node}'`
          }
        } else {
          throw `You should add '${vertex}' first`
        }
      }
      
      print() {
        for (let [key, value] of this.AdjList) {
          console.log(key, value, this.AdjListDistance.get(key))
        }
      }
      
      calculateDistance(route) {
        const vertex = route.split('-')
        let distance = 0
        while(vertex.length - 1) {
          const ver = vertex.shift()
          const nextL = this.AdjList.get(ver)
          const index = nextL.indexOf(vertex[0])
          if (index !== -1) {
            distance = distance + this.AdjListDistance.get(ver)[index]
          } else {
            distance = 0
            break;
          }
        }
        return distance ? distance : 'NO SUCH ROUTE'
      }
              
      getAllSource(destId){
        var source = []
        for (let [key, value] of this.AdjList) {
          if (value.includes(destId)){
            source.push(key)
          }
        }
        return source
      }

      findAllPaths(destination, end, options){
        let sourceId =  this.getAllSource(destination[destination.length - 1])
        const cycle = sourceId.find(ele => ele === end)

        if(sourceId.length === 0 || destination.length > options.limit){
          const des = destination.slice()
          this.allPaths[des.reverse().join('-')] = des
          return;
        }

        if (cycle) {
          let des = destination.slice()
          des = des.concat(cycle)
          this.allPaths[des.reverse().join('-')] = des
        }

        for(var i=0; i < sourceId.length; i++){
          var copy  = destination.slice(0)
          copy.push(sourceId[i])
          this.findAllPaths(copy, end, options)
        }
      }

      getDistanceForCurrentRoute(route) {
        let des = route.slice().reverse().join('-')
        return this.calculateDistance(des)
      }

      findAllPathsWithDis(destination, end, options){
        let sourceId =  this.getAllSource(destination[destination.length - 1])
        const cycle = sourceId.find(ele => ele === end)

        const distance = destination.length > 1 ? this.getDistanceForCurrentRoute(destination) : null
        if(sourceId.length === 0 || ( distance &&  distance > options.distance)){
          const des = destination.slice()
          this.allPathsDis[des.reverse().join('-')] = distance
          return;
        }

        if (cycle) {
          let des = destination.slice()
          des = des.concat(cycle)
          const distance = this.getDistanceForCurrentRoute(des)
          this.allPathsDis[des.reverse().join('-')] = distance
        }

        for(var i=0; i < sourceId.length; i++){
          var copy  = destination.slice(0)
          copy.push(sourceId[i])
          this.findAllPathsWithDis(copy, end, options)
        }
      }
      
      findPathsWithDis(start, des, distance) {
        this.findAllPathsWithDis([des], des, { distance })
        const paths = []
        Object.keys(this.allPathsDis).forEach(ele => {
          const path = ele.split('-')
          const first = path[0]
          if (first === start && this.allPathsDis[ele] < distance) {
            paths.push(this.allPathsDis[ele])
          }
        })
        return paths.length
      }

      findExactPaths(start, des, count) {
        this.findAllPaths([des], des,{ limit: count })
        const paths = []
        Object.keys(this.allPaths).forEach(ele => {
          const path = ele.split('-')
          const first = path[0]
          const last = path[path.length - 1]
          if (first === start && last === des && path.length === count + 1) {
            paths.push(this.allPaths[ele])
          }
        })
        return paths.length
      }

      findPathsWithUpToStops(start, des, count) {
        this.findAllPaths([des], des,{ limit: count })
        const paths = []
        Object.keys(this.allPaths).forEach(ele => {
          const path = ele.split('-')
          const first = path[0]
          const last = path[path.length - 1]
          if (first === start && last === des && path.length <= count + 1) {
            paths.push(this.allPaths[ele])
          }
        })
        return paths.length
      }

      findShortestDis(start, des) {
        const count = this.AdjList.size
        this.findAllPaths([des], des,{ limit: count })
        let distances = {}
        Object.keys(this.allPaths).forEach(ele => {
          const path = ele.split('-')
          const first = path[0]
          const last = path[path.length - 1]
          if (first === start && last === des && path.length <= count + 1) {
            distances[this.calculateDistance(this.allPaths[ele].join('-'))] = 1
          }
        })
        distances = Object.keys(distances)
        return distances.length ? distances[0] : 'NO SUCH ROUTE'
      }

    }
    function main() {
      let g = new Graph()
      let arr = ['A', 'B', 'C', 'D', 'E']
      for (let i = 0; i < arr.length; i++) {
        g.addVertex(arr[i])
      }
      // Test graph: AB5, BC4, CD8, DC8, DE6, AD5, CE2, EB3, AE7
      g.addEdge('A', 'B', 5)
      g.addEdge('B', 'C', 4)
      g.addEdge('C', 'D', 8)
      g.addEdge('D', 'C', 8)
      g.addEdge('D', 'E', 6)
      g.addEdge('A', 'D', 5)
      g.addEdge('C', 'E', 2)
      g.addEdge('E', 'B', 3)
      g.addEdge('A', 'E', 7)

      // print data in console
      g.print()
      document.write('<h6>- - - - - - -', '</h6>')
      document.write('<h6>Test Graph: ',testGraph, '</h6>')
      document.write('<h6>- - - - - - -', '</h6>')
      // Q1
      document.write('<h6>Q1: ', g.calculateDistance('A-B-C'), '</h6>')
      // Q2
      document.write('<h6>Q2: ', g.calculateDistance('A-D'), '</h6>')
      // Q3
      document.write('<h6>Q3: ', g.calculateDistance('A-D-C'), '</h6>')
      // Q4
      document.write('<h6>Q4: ', g.calculateDistance('A-E-B-C-D'), '</h6>')
      // Q5
      document.write('<h6>Q5: ', g.calculateDistance('A-E-D'), '</h6>')
      // Q6
      document.write('<h6>Q6: ', g.findPathsWithUpToStops('C', 'C', 3), '</h6>')
      // Q7
      document.write('<h6>Q7: ', g.findExactPaths('A', 'C', 4), '</h6>')
      // Q8
      document.write('<h6>Q8: ', g.findShortestDis('A', 'C'), '</h6>')
      // Q9
      document.write('<h6>Q9: ', g.findShortestDis('B', 'B'), '</h6>')
      // Q10
      document.write('<h6>Q10: ', g.findPathsWithDis('C', 'C', 30), '</h6>')

      document.write('<h6>- - - - - - -', '</h6>')
      return g
    }
    const graph = main()
    function calDistance() {
      const value = document.getElementById('path').value
      document.getElementById('result1').innerHTML = graph.calculateDistance(value)
    }
    function calRoutesWithMaxRoute() {
      const start = document.getElementById('start1').value
      const end = document.getElementById('end1').value
      const stops = document.getElementById('stops1').value
      document.getElementById('result2').innerHTML = graph.findPathsWithUpToStops(start, end, +stops)
    }
    function calRoutesWithExactRoute() {
      const start = document.getElementById('start2').value
      const end = document.getElementById('end2').value
      const stops = document.getElementById('stops2').value
      document.getElementById('result3').innerHTML = graph.findExactPaths(start, end, +stops)
    }
    function calShortDis() {
      const start = document.getElementById('start3').value
      const end = document.getElementById('end3').value
      document.getElementById('result4').innerHTML = graph.findShortestDis(start, end)

    }
    function noOfRoutes() {
      const start = document.getElementById('start4').value
      const end = document.getElementById('end4').value
      const dis = document.getElementById('distance').value
      document.getElementById('result5').innerHTML = graph.findPathsWithDis(start, end, +dis)

    }
  </script>

  <body>
    <div id="container">

      <div class="wrap">
        <div class="input-group">
          <span class="input-group-text">Q 1-5</span>
          <input id="path" type="text" aria-label="A-B-C" class="form-control" placeholder="e.g... A-B-C">  
          <button onclick="calDistance()" class="btn btn-danger" type="button" id="button-addon2">Distance</button>
        </div>
        <div class="alert alert-primary mt-5" role="alert">
          Result: <span id='result1'></span>
        </div>
      </div>

      <div class="wrap">
        <div class="input-group">
          <span class="input-group-text">Q 6</span>
          <input type="text" id="start1" placeholder="Start" class="form-control">
          <input type="text" id="end1" placeholder="End" class="form-control">
          <input type="text" id="stops1" placeholder="No of Stops" class="form-control">
          <button class="btn btn-danger" onclick="calRoutesWithMaxRoute()" type="button" id="button-addon2">Routes for max stops</button>
        </div>
        <div class="alert alert-primary mt-5" role="alert">
          Result: <span id='result2'></span>
        </div>
      </div>
      
      <div class="wrap">
        <div class="input-group">
          <span class="input-group-text">Q 7</span>
          <input type="text" id="start2" placeholder="Start" class="form-control">
          <input type="text" id="end2" placeholder="End" class="form-control">
          <input type="text" id="stops2" placeholder="No of Stops" class="form-control">
          <button class="btn btn-danger" onclick="calRoutesWithExactRoute()" type="button" id="button-addon2">Routes for exact stops</button>
        </div>
        <div class="alert alert-primary mt-5" role="alert">
          Result: <span id='result3'></span>
        </div>
      </div>
      
      <div class="wrap">
        <div class="input-group">
          <span class="input-group-text">Q 8-9</span>
          <input type="text" id="start3" placeholder="Start" class="form-control">
          <input type="text" id="end3" placeholder="End" class="form-control">
          <button class="btn btn-danger" onclick="calShortDis()" type="button" id="button-addon2">Shortest Distance</button>
        </div>
        <div class="alert alert-primary mt-5" role="alert">
          Result: <span id='result4'></span>
        </div>
      </div>

      <div class="wrap">
        <div class="input-group">
          <span class="input-group-text">Q 10</span>
          <input type="text" id="start4" placeholder="Start" class="form-control">
          <input type="text" id="end4" placeholder="End" class="form-control">
          <input type="text" id="distance" placeholder="Max Distance" class="form-control">
          <button class="btn btn-danger" onclick="noOfRoutes()" type="button" id="button-addon2">No Of Routes</button>
        </div>
        <div class="alert alert-primary mt-5" role="alert">
          Result: <span id='result5'></span>
        </div>
      </div>
    </div>
  </body>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous"></script>
</html>
